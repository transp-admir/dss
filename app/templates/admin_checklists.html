{% extends "base_adm.html" %}

{% block title %}Gerenciar Checklists{% endblock %}

{% block head %}
    {{ super() }}
    {# Reutilizando o CSS da página de conteúdo para um visual consistente #}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/conteudo.css') }}">
    <style>
        .btn-gerenciar {
            background-color: #005A9C;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.2s;
            font-size: 0.9em;
        }
        .btn-gerenciar:hover {
            background-color: #002D4E;
            color: white;
        }
    </style>
{% endblock %}

{% block header %}
    Gerenciar Checklists
{% endblock %}

{% block content %}

<div class="page-actions">
    <button id="btn-novo-conteudo" class="btn-novo">
        <i class="fas fa-plus"></i> Cadastrar Novo Checklist
    </button>
</div>

{# Formulário para criar um novo Checklist Mestre (inicialmente oculto) #}
<div id="form-cadastro" style="display: none;">
    <form method="POST" action="{{ url_for('admin.gerenciar_checklists') }}">
        <div class="form-grid">
            <div>
                <label for="codigo">Código (CÓD)</label>
                <input type="text" id="codigo" name="codigo" placeholder="Ex: CHK-OP-01" required>
            </div>
            <div>
                <label for="revisao">Revisão (REV)</label>
                <input type="text" id="revisao" name="revisao" placeholder="Ex: 00" required>
            </div>
            <div>
                <label for="data">Data de Emissão</label>
                <input type="date" id="data" name="data" required>
            </div>
            <div>
                <label for="tipo">Tipo de Checklist</label>
                <select id="tipo" name="tipo" required>
                    <option value="DIÁRIO">Diário</option>
                    <option value="MENSAL">Mensal</option>
                </select>
            </div>
        </div>
        <br>
        <div class="form-actions">
            <button type="button" id="btn-cancelar" class="btn btn-secondary">Cancelar</button>
            <button type="submit" class="btn btn-primary">Salvar Checklist</button>
        </div>
    </form>
</div>

{# Tabela para listar os Checklists Mestres existentes #}
<div class="conteudo-lista">
    <div class="card-body">
        <table id="datatablesSimple">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Revisão</th>
                    <th>Data</th>
                    <th>Tipo</th>
                    <th>Nº de Itens</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for checklist in checklists %}
                <tr>
                    <td>{{ checklist.codigo }}</td>
                    <td>{{ checklist.revisao }}</td>
                    <td>{{ checklist.data.strftime('%d/%m/%Y') }}</td>
                    <td>{{ checklist.tipo | title }}</td>
                    <td>{{ checklist.itens.count() }}</td> {# CORREÇÃO APLICADA AQUI #}
                    <td>
                        {# O link agora é um botão destacado #}
                        <a href="{{ url_for('admin.checklist_detalhe', checklist_id=checklist.id) }}" class="btn-gerenciar" title="Adicionar/Ver Itens">
                            <i class="fas fa-tasks"></i> Gerenciar Itens
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center">Nenhum checklist cadastrado ainda.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{# Script para alternar a visibilidade do formulário #}
<script>
    document.getElementById('btn-novo-conteudo').addEventListener('click', function() {
        document.getElementById('form-cadastro').style.display = 'block';
        this.style.display = 'none';
    });
    document.getElementById('btn-cancelar').addEventListener('click', function() {
        document.getElementById('form-cadastro').style.display = 'none';
        document.getElementById('btn-novo-conteudo').style.display = 'block';
    });
</script>

{% endblock %}